<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deep Learning MÃ©dico</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

<style>
body{
  margin:0;
  overflow-x:hidden;
  background:#0f172a;
  font-family:system-ui,-apple-system,sans-serif;
  transition:background 1.2s ease;
}

canvas{
  position:fixed;
  inset:0;
  z-index:-1;
}

/* LOGO */
#logo{
  position:fixed;
  top:10px;
  left:10px;
  width:70px;
  height:70px;
  object-fit:contain;
  z-index:50;
}
@media(max-width:640px){
  #logo{ width:50px; height:50px; }
}

/* LOGIN */
.login-card{
  width:90%;
  max-width:380px;
  padding:30px;
  border-radius:20px;
  backdrop-filter:blur(18px);
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.2);
  box-shadow:0 8px 40px rgba(0,0,0,0.4);
  color:white;
  transition:all 0.8s ease;
}

.input-field{
  width:100%;
  padding:12px 15px;
  margin:12px 0;
  border-radius:14px;
  border:none;
  outline:none;
  background:rgba(255,255,255,0.15);
  color:white;
}

.hidden-section{ display:none; }

.fade-out{
  opacity:0;
  transform:scale(0.9);
  transition:all 0.8s ease;
}

.main-container{
  opacity:0;
  transform:translateY(30px);
  transition:all 1s ease;
}
.main-visible{
  opacity:1;
  transform:translateY(0);
}

/* AUDIO BUTTON */
.audio-btn{
  position:fixed;
  bottom:15px;
  right:15px;
  z-index:50;
  padding:10px 16px;
  border-radius:9999px;
  background:rgba(0,0,0,0.6);
  color:white;
  font-weight:600;
  cursor:pointer;
  transition:all 0.3s ease;
}
.audio-btn:hover{ background:rgba(0,0,0,0.8); }

/* CAMERA RESPONSIVE */
#webcam-container{
  width:100%;
  max-width:260px;
  aspect-ratio:1/1;
  position:relative;
}

/* Uploaded image */
#uploadedImage{
  width:100%;
  max-height:250px;
  object-fit:contain;
}
</style>
</head>

<body class="min-h-screen flex items-center justify-center px-4">

<img id="logo" src="logo.png" alt="Logo">
<canvas id="waves"></canvas>
<audio id="ambientAudio" loop></audio>
<div id="audioBtnLogin" class="audio-btn">ðŸ”Š Silenciar</div>

<!-- LOGIN -->
<div id="loginSection" class="login-card">
<h2 class="text-2xl font-bold text-center mb-6">Iniciar SesiÃ³n</h2>

<form id="loginForm">
<input type="text" id="username" class="input-field" placeholder="Usuario">
<input type="password" id="password" class="input-field" placeholder="ContraseÃ±a">

<button type="submit"
class="w-full mt-4 px-6 py-3 rounded-2xl 
bg-gradient-to-r from-cyan-400 via-sky-400 to-blue-500 
text-black font-semibold shadow-xl 
transition-all duration-300 ease-in-out 
hover:scale-105 hover:shadow-2xl hover:shadow-cyan-400/60 
active:scale-95">
Entrar
</button>
</form>
</div>

<!-- MAIN -->
<div id="mainSection" class="hidden-section w-full">
<div class="max-w-6xl mx-auto main-container px-4" id="mainContent">

<header class="text-center mb-10">
<h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-slate-900">
DiagnÃ³stico MÃ©dico de Xray
</h1>
<p class="mt-3 text-slate-700">
CÃ¡mara en tiempo real + AnÃ¡lisis de imÃ¡genes
</p>
</header>

<div class="bg-slate-900/50 backdrop-blur-md rounded-2xl shadow-2xl p-6 sm:p-8 grid grid-cols-1 md:grid-cols-3 gap-8">

<!-- CAMERA -->
<div class="flex flex-col items-center">
<h2 class="text-lg sm:text-xl font-semibold text-white mb-4">CÃ¡mara</h2>

<div class="bg-black/40 p-3 rounded-2xl border border-slate-700 shadow-xl w-full flex justify-center">
<div id="webcam-container"
class="rounded-xl overflow-hidden flex items-center justify-center">
</div>
</div>

<button onclick="init()"
class="w-full mt-6 px-6 py-3 rounded-2xl 
bg-gradient-to-r from-cyan-400 via-sky-400 to-blue-500 
text-black font-semibold shadow-xl 
transition-all duration-300 ease-in-out 
hover:scale-105 hover:shadow-2xl hover:shadow-cyan-400/60 
active:scale-95">
Iniciar CÃ¡mara
</button>
</div>

<!-- UPLOAD -->
<div class="flex flex-col items-center">
<h2 class="text-lg sm:text-xl font-semibold text-white mb-4">Subir Imagen</h2>

<input type="file" id="imageUpload" accept="image/*" hidden>

<button onclick="document.getElementById('imageUpload').click()"
class="w-full px-6 py-3 rounded-2xl 
bg-gradient-to-r from-cyan-400 via-sky-400 to-blue-500 
text-black font-semibold shadow-xl 
transition-all duration-300 ease-in-out 
hover:scale-105 hover:shadow-2xl hover:shadow-cyan-400/60 
active:scale-95">
Seleccionar Imagen
</button>

<p id="fileName" class="text-sm text-slate-300 mt-2 truncate text-center w-full"></p>

<img id="uploadedImage" class="rounded-xl hidden mt-4" />

<button onclick="predictImage()"
class="w-full mt-4 px-6 py-3 rounded-2xl 
bg-gradient-to-r from-cyan-400 via-sky-400 to-blue-500 
text-black font-semibold shadow-xl 
transition-all duration-300 ease-in-out 
hover:scale-105 hover:shadow-2xl hover:shadow-cyan-400/60 
active:scale-95">
Analizar Imagen
</button>
</div>

<!-- RESULTS -->
<div>
<h2 class="text-lg sm:text-xl font-semibold text-white mb-4">Predicciones</h2>
<div id="label-container" class="space-y-3 text-white"></div>
</div>

</div>
</div>
</div>

<div id="audioBtnMain" class="audio-btn hidden">ðŸ”Š Silenciar</div>

<script>
/* AUDIO ALEATORIO */
const ambientAudio=document.getElementById("ambientAudio");
ambientAudio.volume=0.2;
let audioStarted=false;
let isMuted=false;
const audios=["ambiente.mp3","ambiente1.mp3","ambiente2.mp3"];

function startAudio(){
 if(!audioStarted){
   ambientAudio.src=audios[Math.floor(Math.random()*audios.length)];
   ambientAudio.play().catch(()=>{});
   audioStarted=true;
 }
}

function toggleAudio(){
 ambientAudio.muted=!ambientAudio.muted;
 isMuted=ambientAudio.muted;
 const text=isMuted?"ðŸ”‡ Activar":"ðŸ”Š Silenciar";
 audioBtnLogin.textContent=text;
 audioBtnMain.textContent=text;
}
audioBtnLogin.onclick=toggleAudio;
audioBtnMain.onclick=toggleAudio;

/* LOGIN */
loginForm.addEventListener("submit",e=>{
 e.preventDefault();
 startAudio();
 if(username.value==="doc"&&password.value==="1234"){
   loginSection.classList.add("fade-out");
   setTimeout(()=>{
     document.body.style.background="#f4f7fa";
     waveColor="cyan";
     loginSection.style.display="none";
     mainSection.classList.remove("hidden-section");
     audioBtnMain.classList.remove("hidden");
     audioBtnLogin.classList.add("hidden");
     setTimeout(()=>mainContent.classList.add("main-visible"),200);
   },800);
 }else alert("Credenciales incorrectas");
});

/* MODEL */
const URL="https://teachablemachine.withgoogle.com/models/ScnoaiVJY/";
let model,webcam,labelContainer,maxPredictions;

async function loadModel(){
 const modelURL=URL+"model.json";
 const metadataURL=URL+"metadata.json";
 model=await window.tmImage.load(modelURL,metadataURL);
 maxPredictions=model.getTotalClasses();
 labelContainer=document.getElementById("label-container");
 labelContainer.innerHTML="";
 for(let i=0;i<maxPredictions;i++){
   const div=document.createElement("div");
   div.className="bg-white/10 rounded-lg px-4 py-2";
   labelContainer.appendChild(div);
 }
}

async function init(){
 if(!model) await loadModel();
 webcam=new window.tmImage.Webcam(260,260,true);
 await webcam.setup();
 await webcam.play();
 window.requestAnimationFrame(loop);
 const container=document.getElementById("webcam-container");
 container.innerHTML="";
 webcam.canvas.style.position="absolute";
 webcam.canvas.style.width="100%";
 webcam.canvas.style.height="100%";
 webcam.canvas.style.top="50%";
 webcam.canvas.style.left="50%";
 webcam.canvas.style.transform="translate(-50%,-50%)";
 webcam.canvas.style.objectFit="cover";
 webcam.canvas.classList.add("rounded-xl");
 container.appendChild(webcam.canvas);
}

async function loop(){
 webcam.update();
 await predict(webcam.canvas);
 requestAnimationFrame(loop);
}

async function predict(source){
 const prediction=await model.predict(source);
 for(let i=0;i<maxPredictions;i++){
   const percentage=(prediction[i].probability*100).toFixed(2);
   labelContainer.childNodes[i].innerHTML=
   `<strong>${prediction[i].className}</strong>: ${percentage}%`;
 }
}

imageUpload.addEventListener("change",e=>{
 const file=e.target.files[0];
 if(!file) return;
 const reader=new FileReader();
 reader.onload=ev=>{
   uploadedImage.src=ev.target.result;
   uploadedImage.classList.remove("hidden");
 };
 reader.readAsDataURL(file);
 fileName.textContent="Archivo: "+file.name;
});

async function predictImage(){
 if(!model) await loadModel();
 if(!uploadedImage.src) return alert("Primero sube una imagen.");
 await predict(uploadedImage);
}

/* WAVES */
const canvas=document.getElementById("waves");
const ctx=canvas.getContext("2d");
let w,h,t=0;
let waveColor="white";

function resize(){
 w=canvas.width=window.innerWidth;
 h=canvas.height=window.innerHeight;
}
window.addEventListener("resize",resize);
resize();

function draw(){
 ctx.clearRect(0,0,w,h);
 ctx.lineWidth=6;
 for(let i=0;i<3;i++){
   ctx.beginPath();
   ctx.strokeStyle=waveColor==="white"
   ?`rgba(255,255,255,${0.35-i*0.08})`
   :`rgba(0,200,255,${0.25-i*0.05})`;
   for(let x=0;x<w;x++){
     const y=h/2+
       Math.sin(x*0.007+t+i)*80+
       Math.sin(x*0.014+t*1.4)*40;
     ctx.lineTo(x,y+i*35);
   }
   ctx.stroke();
 }
 t+=0.02;
 requestAnimationFrame(draw);
}
draw();
</script>

</body>
</html>


